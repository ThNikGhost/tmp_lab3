# REPORT — Практика 3: CI/DevSecOps

## Репозиторий и ветка
- **Repo:** [\[repo\]](https://github.com/ThNikGhost/tmp_lab3)
- **PR/MR:** [\[pull request\]](https://github.com/ThNikGhost/tmp_lab3/pulls)

## CI и результаты

### 1. Логи успешной прогонки
- **Ссылка:** [\[url\]](https://github.com/ThNikGhost/tmp_lab3/actions/runs/19965800339)
- **Описание:** Пайплайн успешно прошел все стадии:
  - `pre-commit`: проверка стиля кода (Black, Flake8) и синтаксиса YAML.
  - `leaks`: секретов не обнаружено.
  - `semgrep`: статический анализ (SAST) не выявил критических ошибок.
  - `trivy-fs` / `trivy-image`: критических уязвимостей в зависимостях и образе нет.
  - `build-test`: Docker-образ собран, тесты `pytest` прошли.

### 2. Логи провальных сценариев (Демонстрация защиты)
- **Ссылка/Скриншот:** [\[url\]](https://github.com/ThNikGhost/tmp_lab3/pull/1)
- **Описание:** В рамках тестирования DevSecOps инструментов были симулированы ошибки:
  - Добавлен "фейковый" AWS-ключ → **Gitleaks** заблокировал пайплайн.
  - Добавлена уязвимая версия библиотеки → **Trivy** обнаружил CVE и остановил сборку.
  - Нарушен Code Style → **Pre-commit** вернул ошибку форматирования.

## Артефакты
*Все артефакты доступны во вкладке "Actions" -> [Название запуска] -> раздел "Artifacts".*

- `gitleaks.sarif` — Отчет о поиске секретов.
- `semgrep.sarif` — Отчет SAST анализа по OWASP Top 10.
- `trivy-fs.sarif` — Уязвимости в файловой системе/зависимостях.
- `trivy-image.sarif` — Уязвимости в Docker-образе.
- `sbom.cdx.json` — Полный перечень компонентов ПО (SBOM) в формате CycloneDX.

## Выводы

### Ключевые находки и их устранение
1.  **Настройка Gitleaks:** Решена проблема с установкой через скрипт (ошибка `No such file`) путем замены на прямую загрузку бинарного файла.
2.  **Интеграция SBOM:** Внедрена генерация Software Bill of Materials через Trivy (формат CycloneDX). Это позволяет отслеживать полный состав ПО и лицензии.
3.  **Защита ветки (Branch Protection):** Настроены правила для `main`: запрет прямого пуша, требование Pull Request и успешного прохождения всех CI-проверок.
4.  **Исправление кода:** Устранены ошибки валидации YAML и нарушения стиля кода (PEP8), выявленные линтерами.

### План улучшений
1.  **Кэширование:** Настроить `actions/cache` для pip и pre-commit, чтобы ускорить сборку.
2.  **Исключения (False Positives):** Создать `.trivyignore` для подавления известных некритичных срабатываний.
3.  **Уведомления:** Настроить алерты в мессенджер при падении пайплайна в `main`.